QUICK FIX FOR WEB SEARCH
========================

The issue is that web search is added but not being triggered properly. Here's what to check:

1. SSH to server:
   ssh root@146.190.39.214

2. Check if web_search.py exists:
   cd /var/www/smart-doc-v2
   ls -la web_search.py

3. If it doesn't exist, create it:
   nano web_search.py
   # Copy the content from create-web-search.py file

4. Install required package:
   source ../smart-document-assistant/venv/bin/activate
   pip install beautifulsoup4

5. Check the app.py integration:
   nano app.py
   # Go to line 253 (Ctrl+_ then type 253)
   
   Make sure the web search block looks like this (proper indentation):
   
        # Web search
        web_keywords = ['search the web', 'google', 'what is', 'latest', 'news', 'current', 'today', 'stock price', 'search online']
        web_context = ""
        
        if any(keyword in message_lower for keyword in web_keywords):
            import re
            search_query = re.sub(r'\b(search|the web|online|google|look up|for)\b', '', message_lower).strip()
            
            if search_query:
                try:
                    from web_search import search_web
                    results = search_web(search_query, 3)
                    
                    if results:
                        web_context = f"\n\nWeb search results for '{search_query}':\n"
                        for r in results:
                            web_context += f"- {r['title']}\n  {r['snippet'][:100]}...\n"
                except Exception as e:
                    print(f"Web search error: {e}")

6. IMPORTANT: Make sure web_context is added to system_prompt:
   # Find where system_prompt is defined (around line 270)
   # It should include both drive_context AND web_context:
   
   system_prompt = f"""You are 'G', a FordDirect Digital Performance Consultant..."""{drive_context}{web_context}"""

7. Save and restart:
   Ctrl+X, Y, Enter
   pm2 restart smart-doc-v2
   pm2 logs smart-doc-v2 --lines 20

8. Test with:
   "Hey G, search the web for Tesla stock price today"
   "Google the latest Ford F-150 Lightning reviews"

The key issue is likely:
- Missing web_search.py file
- Missing beautifulsoup4 package
- web_context not being added to system_prompt
- Incorrect indentation in app.py