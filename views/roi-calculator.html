<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROI Calculator - Auto Audit Pro Suite</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/navigation.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary-purple: #6B46C1;
            --secondary-purple: #9333EA;
            --accent-green: #10B981;
            --accent-red: #EF4444;
            --dark-bg: #1F2937;
        }

        body {
            background: #F3F4F6;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
        }

        /* Navigation styles removed - using external navigation.css */
/* Main Content */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem 4rem 2rem;
        }

        .page-header {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .page-header h1 {
            color: var(--dark-bg);
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        /* Calculator Container */
        .calculator-container {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .result-card {
            background: #F3F0FF;
            border: 2px solid var(--primary-purple);
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
            display: none;
        }

        .result-card.active {
            display: block;
        }

        .metric-value {
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary-purple);
            margin: 0;
        }

        .form-control-lg {
            font-size: 1.25rem;
            padding: 0.75rem 1rem;
        }

        .improvement-badge {
            background: var(--accent-green);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="suite-nav">
        <div class="container">
            <div class="suite-title">Auto Audit Pro Suite</div>
            <div class="nav-links">
                <a href="/website-audit">Website Analysis</a>
                <a href="/lead-analysis" class="active">Lead Performance</a>
                <a href="/monitoring">Monitoring</a>
                <a href="/definitions">Definitions</a>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1><i class="fas fa-calculator"></i> ROI Calculator</h1>
                    <p class="mb-0" id="dealerInfo">Calculate your potential revenue increase from improved lead conversion</p>
                </div>
                <div>
                    <a href="/lead-analysis" class="btn btn-outline-primary">
                        <i class="fas fa-arrow-left"></i> Back to Analysis
                    </a>
                </div>
            </div>
        </div>

        <!-- Calculator -->
        <div class="calculator-container">
            <div class="row">
                <div class="col-md-5">
                    <h4 class="mb-4">Current Performance</h4>
                    <div class="mb-4">
                        <label class="form-label fw-bold">Current Conversion Rate (%)</label>
                        <input type="number" id="currentConversion" class="form-control form-control-lg" 
                               placeholder="e.g. 12.5" step="0.1" min="0" max="100">
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold">Monthly Lead Volume</label>
                        <input type="number" id="currentLeads" class="form-control form-control-lg" 
                               placeholder="e.g. 450" min="0">
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold">Average Gross Profit per Sale</label>
                        <input type="number" id="avgGross" class="form-control form-control-lg" 
                               placeholder="e.g. 4250" value="4250" min="0">
                    </div>
                    
                    <div class="mt-4 p-3 bg-light rounded">
                        <small class="text-muted">Current Monthly Sales</small>
                        <div class="h4 mb-0" id="currentMonthlySales">-</div>
                    </div>
                </div>
                
                <div class="col-md-7">
                    <h4 class="mb-4">Quick Conversion Improvements</h4>
                    
                    <div class="row mb-3">
                        <div class="col-4 mb-2">
                            <button class="btn btn-outline-primary w-100" onclick="calculateImprovement(1)">+1%</button>
                        </div>
                        <div class="col-4 mb-2">
                            <button class="btn btn-outline-primary w-100" onclick="calculateImprovement(2)">+2%</button>
                        </div>
                        <div class="col-4 mb-2">
                            <button class="btn btn-outline-primary w-100" onclick="calculateImprovement(3)">+3%</button>
                        </div>
                        <div class="col-4 mb-2">
                            <button class="btn btn-outline-primary w-100" onclick="calculateImprovement(4)">+4%</button>
                        </div>
                        <div class="col-4 mb-2">
                            <button class="btn btn-outline-primary w-100" onclick="calculateImprovement(5)">+5%</button>
                        </div>
                        <div class="col-4 mb-2">
                            <button class="btn btn-outline-info w-100" onclick="calculateToTarget(16.12)">
                                Network Avg<br><small>16.12%</small>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <button class="btn btn-success w-100" onclick="calculateToTarget(20)">
                            Achieve Elite Status (20%+ Conversion)
                        </button>
                    </div>
                    
                    <div class="mt-3">
                        <label class="form-label">Or Enter Custom Target Rate (%)</label>
                        <div class="input-group">
                            <input type="number" id="customTarget" class="form-control" step="0.1" placeholder="e.g. 18.5">
                            <button class="btn btn-primary" onclick="calculateCustom()">Calculate</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Results -->
            <div class="result-card" id="resultsCard">
                <div class="improvement-badge" id="improvementBadge">+2% Improvement</div>
                <h3 class="mb-4">Projected Monthly Impact</h3>
                <div class="row">
                    <div class="col-md-4 text-center mb-3">
                        <small class="text-muted d-block">Additional Sales</small>
                        <p class="metric-value" id="additionalSales">-</p>
                    </div>
                    <div class="col-md-4 text-center mb-3">
                        <small class="text-muted d-block">Additional Revenue</small>
                        <p class="metric-value" id="additionalRevenue">-</p>
                    </div>
                    <div class="col-md-4 text-center mb-3">
                        <small class="text-muted d-block">Annual Impact</small>
                        <p class="metric-value" id="annualImpact">-</p>
                    </div>
                </div>
                <div class="mt-4 p-3 bg-white rounded">
                    <div class="row">
                        <div class="col-6">
                            <small class="text-muted">New Conversion Rate</small>
                            <div class="h5 mb-0" id="newConversionRate">-</div>
                        </div>
                        <div class="col-6">
                            <small class="text-muted">Total Monthly Sales</small>
                            <div class="h5 mb-0" id="newMonthlySales">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check for data passed from other pages
        document.addEventListener('DOMContentLoaded', function() {
            const dealerData = localStorage.getItem('roiCalculatorDealer');
            const fromStandalone = localStorage.getItem('fromStandaloneAnalysis');
            
            if (dealerData) {
                try {
                    const dealer = JSON.parse(dealerData);
                    console.log('Loading dealer data:', dealer);
                    
                    // Update page header with dealer name
                    if (dealer.name) {
                        document.getElementById('dealerInfo').textContent = `${dealer.name} - Calculate potential revenue increase`;
                    }
                    
                    // Populate fields
                    if (dealer.conversion_rate) {
                        document.getElementById('currentConversion').value = dealer.conversion_rate;
                    }
                    if (dealer.total_leads) {
                        document.getElementById('currentLeads').value = dealer.total_leads;
                    }
                    
                    // Calculate current monthly sales
                    updateCurrentSales();
                    
                    // Clear the data after loading
                    localStorage.removeItem('roiCalculatorDealer');
                    localStorage.removeItem('fromStandaloneAnalysis');
                    
                    // Auto-calculate +2% improvement as a starting point
                    setTimeout(() => calculateImprovement(2), 500);
                } catch (e) {
                    console.error('Error loading dealer data:', e);
                }
            }
            
            // Add input listeners
            document.getElementById('currentConversion').addEventListener('input', updateCurrentSales);
            document.getElementById('currentLeads').addEventListener('input', updateCurrentSales);
            document.getElementById('avgGross').addEventListener('input', updateCurrentSales);
        });
        
        function updateCurrentSales() {
            const conversion = parseFloat(document.getElementById('currentConversion').value) || 0;
            const leads = parseFloat(document.getElementById('currentLeads').value) || 0;
            const currentSales = Math.round(leads * (conversion / 100));
            document.getElementById('currentMonthlySales').textContent = currentSales;
        }
        
        function calculateImprovement(percent) {
            const currentRate = parseFloat(document.getElementById('currentConversion').value) || 0;
            const newRate = currentRate + percent;
            calculate(currentRate, newRate, `+${percent}% Improvement`);
        }
        
        function calculateToTarget(targetRate) {
            const currentRate = parseFloat(document.getElementById('currentConversion').value) || 0;
            const improvement = targetRate - currentRate;
            const label = targetRate === 16.12 ? 'Network Average' : 'Elite Status';
            calculate(currentRate, targetRate, `${label} (+${improvement.toFixed(1)}%)`);
        }
        
        function calculateCustom() {
            const currentRate = parseFloat(document.getElementById('currentConversion').value) || 0;
            const targetRate = parseFloat(document.getElementById('customTarget').value) || 0;
            const improvement = targetRate - currentRate;
            calculate(currentRate, targetRate, `Custom Target (+${improvement.toFixed(1)}%)`);
        }
        
        function calculate(currentRate, newRate, label) {
            const leads = parseFloat(document.getElementById('currentLeads').value) || 0;
            const avgGross = parseFloat(document.getElementById('avgGross').value) || 4250;
            
            const currentSales = leads * (currentRate / 100);
            const newSales = leads * (newRate / 100);
            const additionalSales = newSales - currentSales;
            const additionalRevenue = additionalSales * avgGross;
            const annualImpact = additionalRevenue * 12;
            
            // Update results
            document.getElementById('improvementBadge').textContent = label;
            document.getElementById('additionalSales').textContent = Math.round(additionalSales);
            document.getElementById('additionalRevenue').textContent = '$' + Math.round(additionalRevenue).toLocaleString();
            document.getElementById('annualImpact').textContent = '$' + Math.round(annualImpact).toLocaleString();
            document.getElementById('newConversionRate').textContent = newRate.toFixed(1) + '%';
            document.getElementById('newMonthlySales').textContent = Math.round(newSales);
            
            // Show results
            document.getElementById('resultsCard').classList.add('active');
        }
    </script>

    <!-- Footer -->
    <footer style="background-color: #1F2937; color: #9CA3AF; padding: 2rem 0; margin-top: 4rem;">
        <div class="container text-center">
            <p class="mb-1">Â© 2025 Auto Audit Pro Suite. All Rights Reserved.</p>
            <p class="mb-0">Professional Dealership Website Analysis Platform</p>
        </div>
    </footer>
</body>
</html>